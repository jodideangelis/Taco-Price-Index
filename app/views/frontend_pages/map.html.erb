<body class="bg-cream text-center">
<header class="bg-rose p-4"></header>

<!-- Filter Bar -->
<%= render 'frontend_pages/filter_bar' %>
<div class="container-fluid">
  <section class="p-4">
    <h1 class="map-title">Map Page</h1>
  </section>

  <div class="row">
    <!-- Map Container -->
    <section class="p-4 map-section text-white">
      <h3>Search & Filter via Map</h3>
      <div class="search-bar p-2 mb-3">Search for restaurants, salsas, etc.</div>
      <div class="map-frame mb-4">
        <div class="col-md-9">
          <div id="map" style="height: 600px;" data-controller="map" data-map-restaurants-value="<%= @restaurants.to_json %>">
          </div>
        </div>
      </div>
    </section>

    <!-- Restaurant List Section -->
    <div class="restaurant-list-section">
      <div class="container-fluid">
        <!-- Section Header -->
        <div class="row mb-4">
          <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
              <h2 class="section-title text-rose">Featured Restaurants</h2>
              <%= link_to 'Add a Restaurant', new_restaurant_path, class: 'btn btn-primary' %>
            </div>
          </div>
        </div>
        
        <!-- Restaurant Cards -->
        <div class="row">
          <div class="col-12">
            <%= render 'frontend_pages/restaurant_list' %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<footer class="bg-rose p-4 mt-4"></footer>

<script>
// Global function to handle pinning restaurants on map
window.pinOnMap = function(restaurantId, lat, lng) {
  console.log(`Attempting to pin restaurant ${restaurantId} at ${lat}, ${lng}`);
  
  // Find the map controller instance
  const mapElement = document.querySelector('[data-controller="map"]');
  if (!mapElement) {
    console.error('Map element not found');
    return;
  }
  
  // Get the Stimulus controller
  const mapController = mapElement.application?.getControllerForElementAndIdentifier(mapElement, 'map');
  if (!mapController) {
    console.error('Map controller not found');
    return;
  }
  
  // Call the pinRestaurantOnMap method
  if (typeof mapController.pinRestaurantOnMap === 'function') {
    mapController.pinRestaurantOnMap(restaurantId, lat, lng);
    
    // Scroll to map section
    const mapSection = document.querySelector('.map-section');
    if (mapSection) {
      mapSection.scrollIntoView({ 
        behavior: 'smooth', 
        block: 'center' 
      });
    }
  } else {
    console.error('pinRestaurantOnMap method not found on map controller');
  }
};
</script>

</body>
